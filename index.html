<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>JSON to CSV Converter</title>
</head>
<body>

    <h1>Convertir JSON en CSV</h1>
    
    <!-- Input pour charger un fichier -->
    <input type="file" id="jsonFileInput" accept=".json">
    <button onclick="convertJsonToCsv()">Convertir et Télécharger CSV</button>

    <script>
        // Fonction pour convertir le JSON en CSV
        function convertJsonToCsv() {
            const input = document.getElementById('jsonFileInput').files[0];
            
            if (!input) {
                alert("Veuillez joindre un fichier JSON.");
                return;
            }

            const reader = new FileReader();

            reader.onload = function(event) {
                const jsonData = event.target.result;
                const lines = jsonData.split('\n');
                let csvContent = "ID,user_login,user_email,user_registered,ip,first_name,last_name\n";

                lines.forEach(line => {
                    if (line.trim()) {
                        const entry = JSON.parse(line);
                        const wp_user = entry.wp_user || {};
                        const wp_user_meta = entry.wp_user_meta || {};

                        const ID = wp_user.ID || '';
                        const user_login = wp_user.user_login || '';
                        const user_email = wp_user.user_email || '';
                        const user_registered = wp_user.user_registered || '';
                        
                        const first_name = (wp_user_meta.first_name || [''])[0];
                        const last_name = (wp_user_meta.last_name || [''])[0];
                        
                        let ip = '';
                        const session_tokens = wp_user_meta.session_tokens || [];
                        if (session_tokens.length > 0) {
                            const first_token = Object.values(session_tokens[0])[0];
                            ip = first_token.ip || '';
                        }

                        // Ajouter les informations dans le contenu CSV
                        csvContent += `${ID},${user_login},${user_email},${user_registered},${ip},${first_name},${last_name}\n`;
                    }
                });

                // Télécharger le fichier CSV
                downloadCsv(csvContent);
            };

            // Lire le fichier JSON en tant que texte
            reader.readAsText(input);
        }

        // Fonction pour télécharger le fichier CSV
        function downloadCsv(csvContent) {
            const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
            const url = URL.createObjectURL(blob);
            const link = document.createElement("a");
            link.setAttribute("href", url);
            link.setAttribute("download", "user.csv");
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
        }
    </script>

</body>
</html>
